#!/usr/bin/env bash

set -eu

build=false
args=()

while (( $# > 0 )); do
  case $1 in
    --build)
      build=true
      ;;
    *)
      args+=("$1")
      ;;
  esac
  shift
done

COMPOSE_FILE=./config/docker/rails_template_test/docker-compose.yml

if $build; then
  docker compose --file=${COMPOSE_FILE} build --build-arg NODE_VERSION=$(cat .node-version)
fi
docker compose --file=${COMPOSE_FILE} run --rm app "${args[@]}"
