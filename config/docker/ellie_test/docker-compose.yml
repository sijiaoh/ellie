version: "3.8"
services:
  db:
    container_name: ellie_test_db
    image: mysql:8
    environment:
      MYSQL_ROOT_PASSWORD: password
    healthcheck:
      test: mysqladmin ping -h 127.0.0.1
  app:
    container_name: ellie_test
    image: ellie_test
    build:
      context: ../../..
      dockerfile: ./config/docker/ellie_test/Dockerfile
    environment:
      RAILS_ENV: test
      ELLIE_DATABASE_HOST: db
    depends_on:
      db:
        condition: service_healthy
